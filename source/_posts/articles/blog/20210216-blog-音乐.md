---
title: Blog 音乐
date: 2021-02-16 21:08:57
updated: 2021-02-19 10:28:11
author: Forrest
tags:
categories: 博客
---

## 1. 定制页面

新建 page

```
hexo new page music
```

修改 `music/index.md`，注意 layout 是指明该页面的布局为 custom-music

```markdown
---
layout: custom-music
index: true
sidebar: [toc]
---

## 欧美

<meting-js server="netease" type="playlist" id="142902542" listfolded listmaxheight="150px"></meting-js>

## 那些年甜甜的歌，甜到爆表～～～

<meting-js server="netease" type="playlist" id="2339725169" listfolded listmaxheight="150px"></meting-js>
```

在主题下添加 `custom-music.ejs`，这里的文件名要与刚刚 layout 的名字保持一致

```ejs
<div class='l_main<%- page.sidebar == false ? ' no_sidebar' : '' %>'>
  <div class="article md post white-box shadow">
    <%- page.content %>
  </div>
</div>
<%- partial('_partial/side') %>

<%- css('https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css') %>
```

## 2. 生成歌单数据


## 3. Pjax 兼容

Volantis 主题支持 Pjax，所以需要在切换到音乐界面时，动态引入 `Aplayer.js` 和 `Meting.js`，大致思路如下：

### 3.1 动态引入第三方库

在站点下添加 `source\js\music.js`

```js
export default {
  loadMusic() {
    if (!window.APlayer) {
      let customScript = document.getElementById('cream-script');
      let jsAplayer = document.createElement('script');
      jsAplayer.src = 'https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js';
      jsAplayer.onload = function () {
        if (!window.MetingJSElement) {
          let jsMeting = document.createElement('script');
          jsMeting.src = 'https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js';
          jsMeting.onload = () => { window.volantis.APlayerLoaded = 1 }
          customScript.insertAdjacentElement('beforeend', jsMeting);
        }
      }
      customScript.insertAdjacentElement('beforeend', jsAplayer);
    }
  }
}
```

### 3.2 添加 pjax 模块布局

在主题下添加 `custom-pjax.ejs`

```ejs
<script type="module" id="cream-script" async defer>
import { default as musicModule } from '/js/music.js'

window.Cream = {
  music: musicModule
};

$(document).on('pjax:complete', () => {
  if (location.pathname == '/music/') {
    Cream.music.loadMusic();
  }
})
</script>
```

在主题下 `layout\layout.ejs` 引入 custom-pjax 布局

```git
+ <%- partial('custom-pjax') %>
```

## 4. 修改导航链接

首先整理一下上述的思路：

- Hexo 将 `source/music/index.md` 生成 `music/index.html` 文件，所以在访问 music/ 时会默认展示 `music/index.html` 页面
- 主题下的 `layout.ejs` 在所有页面都生效，所以自定义的 `custom-pjax.ejs` 一定要在该文件中引入
- 在 `pjax` 模块中添加了 window.Cream 全局变量，用它来存储之后自己编写的其他模块文件，例如相册、游戏等等

综上，根据不同主题的配置，修改导航菜单的 URL 为 `music/` 即可