---
title: Blog 相册
date: 2021-02-18 10:23:00
updated: 2021-02-21 12:27:00
author: Forrest
tags:
categories: 博客
---

## 1. 定制页面

### 1.1 生成相册首页

参考 `hexo-generator-archive` 修改为 `generator-gallery.js` 放入网站根目录的 Scripts 下，用于生成相册首页的目录。用 Packages 的方式需要上传 npm 包，在本地导入依赖在使用 npm 时会报错。

```js
'use strict';

const pagination = require('hexo-pagination');

/* global hexo */

if (!(hexo.config.gallery && hexo.config.gallery.enabled === false)) {
  let per_page = 3;

  hexo.extend.generator.register('gallery', function (locals) {
    const config = this.config;
    let galleryDir = config.gallery_dir;
    const paginationDir = config.pagination_dir || 'page';
    const galleries = locals.data && locals.data.gallery
      ? locals.data.gallery.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())
      : [];
    const perPage = per_page;
    let result = [];

    if (!galleries.length) return;

    if (galleryDir[galleryDir.length - 1] !== '/') galleryDir += '/';

    function generate(path, posts, options) {
      options = options || {};
      options.index = true; // 提供 index 判断是否为相册首页
      result = result.concat(pagination(path, posts, {
        perPage: perPage,
        layout: ['custom-gallery'],
        format: paginationDir + '/%d/',
        data: options
      }));
    }
    generate(galleryDir, galleries);

    return result;
  });
}
```

站点配置

```yml
# Directory
gallery_dir: gallery
```

主题下添加 `custom-gallery.ejs`

```ejs
<% if(page.index) { %>
  <div class="custom-gallery-wrap">
    <% page.posts.forEach((post) => { %>
      <a href="/gallery/<%- post.path %>" class="item">
        <img src="<%= post.cover %>">
        <div class="title-wrap">
          <div class="mask">
            <h3 class="title"><%= post.path %></h3>
            <span class="time"><%- date(post.date, "YYYY-MM-DD") %></span>
          </div>
        </div>
      </a>
    <% }) %>
  </div>
<% } else { %>
  <div class="md">
    <%- page.content %>
  </div>
<% } %>
```

### 1.2 使用数据文件

添加 `source/_data/gallery.json`，

```json
[
  {
    "path": "测试",
    "cover": "https://cdn.jsdelivr.net/gh/small-rose/love-images@main/wenyi/wenyi-04.jpg",
    "date": "2021-02-18"
  },
  {
    "path": "壁纸",
    "cover": "https://picup.heson10.com/img/upyun/home_top_bg.webp",
    "date": "2021-02-22"
  }
]
```

### 1.3 编写相册内容

在 `source/gallery` 下新增 `测试/index.md` 和 `壁纸/index.md`，其中 Front-matter 设置如下，其余内容和编写文章一致

```markdown
---
title: PATH LIKE '测试' OR '壁纸'
layout: custom-gallery
---
```

### 1.4 修改导航链接

首先整理一下上述的思路：

1. 利用 generator 生成相册首页的数据，通过 `custom-gallery.ejs` 渲染相册首页和相册内容，为了区分首页和内容，在生成相册首页时，添加 `index: true` 配置
2. 相册首页需要获取所有的相册信息，通过配置相册数据文件 `gallery.json` 来提供给 generator 读取
3. 相册内容设置用 `custom-gallery.ejs` 渲染

综上，相册首页地址 `gallery/`，某个相册内容地址为 `gallery/TITLE` 或 `gallery/TITLE/index.html`

## 2. 简单响应式相册

如果不能预先知道图片的大小，就无法使用瀑布流布局，实现的效果大致是，无论图片有多大，缩略图展示都为正方形且不拉伸。

```stylus
.custom-gallery-wrap
  display grid
  grid-template-columns repeat(auto-fit, minmax(100px, 300px))
  gap 10px
  justify-content center
  width 100%

  .item
    position relative
    padding-top 100%
    transition all 0.3s cubic-bezier(0.25, 0.5, 0.5, 0.9) 0s

    img, .title-wrap
      position absolute
      display block
      object-fit cover
      width 100%
      height 100%
      top 0px
      left 0px

    .mask
      position absolute
      bottom 0px
      width 100%
      background linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75))
      padding 10px
      display flex
      align-items flex-end
      justify-content space-between

      .title
        margin 0px
        color rgb(255, 255, 255)
        font-size 24px

      .time
        color #fff
        font-size 12px
```

## 3. 瀑布流相册