---
title: Blog 情侣专栏
date: 2021-02-19 08:57:51
updated: 2021-02-19 08:57:51
author: Forrest
tags:
categories: 博客
---

## 1. 日常

“日常”模块用于展示情侣日常，希望写日常文章能和写文档一样，只是这些文章仅出现在日常列表页里。

首先要区分普通文章和其他类型文章（情侣日常，电影，游戏等），在文章头部声明 `custom_type` 来指定类型。您若不希望在首页和归档中展示这些文章，还需要修改首页生成和归档生成的代码。

### 1.1 修改首页、归档生成器

修改 `hexo-generator-archive/lib/generator.js`

```git
// 过滤 posts 的函数
+ const filterType = (posts) => {
+   return posts.filter((o => typeof o.custom_type == 'undefined'));
+ }

// 修改 exports 中 allPost
- const allPosts = locals.posts.sort(config.archive_generator.order_by || '-date');
+ const allPosts = filterType(locals.posts).sort(config.archive_generator.order_by || '-date');

// generate 函数中增加
+ options.archiveNum = allPosts.length; // 归档显示数据要用
```

修改主题下的 `layout/archive.ejs`

```git
- <%- partial('_partial/archive-list.ejs', { params: { postTotal: site.posts.length } }) %>
+ <%- partial('_partial/archive-list.ejs', { params: { postTotal: page.archiveNum } }) %>
```

修改 `hexo-generator-index/lib/generator.js`

```git
+ const filterType = (posts) => {
+   return posts.filter((o => typeof o.custom_type == 'undefined'));
+ }

- const posts = locals.posts.sort(config.index_generator.order_by);
+ const posts = filterType(locals.posts).sort(config.index_generator.order_by);
```

### 1.2 定制日常列表页

新建页面

```bash
hexo new page life
```

修改 Front-matter，采用自定义的列表布局（参考归档界面），通过 `custom_type: life` 指明该列表展示的文章类型

```markdown
---
layout: custom-list
custom_type: life
sidebar: [blogger, category, tagcloud]
index: true
---
```

修改主题 menu 配置（略）

在主题下添加 `layout/custom-list.ejs`，参照归档页布局

```ejs
<%- partial('_pre') %>
<div class='l_main<%- page.sidebar == false ? ' no_sidebar' : '' %>'>
  <article id="arc" class="post article white-box reveal <%- theme.custom_css.body.effect.join(' ') %>">
    <% var year = -1, postid = -1; %>
    <% site.posts.sort('date', -1).each(function(post) { %>
      <% post.year = date(post.date, 'YYYY'); %>
      <% if (post.custom_type === page.custom_type) { %>
        <% if (post.year && post.year !== year) { %>
          <% year = post.year; %>
          <h2><%= year %></h2>
        <% } %>
          <div class='timenode'>
              <a class="meta" href="<%= url_for(post.link || post.path) %>">
                <time><%= date(post.date, 'MM-DD') %></time>
                <% if(post.title){ %>
                  <%- post.title %>
                <% } else if (post.date) { %>
                  <%= date(post.date, config.date_format) %>
                <% } %>
                <% if(theme.plugins.aplayer && theme.plugins.aplayer.enable && post.music && post.music.enable != false){ %>
                  &nbsp;<i class="fas fa-headphones-alt music" aria-hidden="true"></i>
                <% } %>
                <% if (post.icon) { %>
                  &nbsp;<i class="<%- post.icon %>" aria-hidden="true"></i>
                <% } %>
                <% (post.icons && post.icons||[]).forEach(function(icon){ %>
                  &nbsp;<i class="<%- icon %>" aria-hidden="true"></i>
                <% }) %>
              </a>
          </div>
      <% } %>
    <% }); %>
  </article>
</div>
<%- partial('_partial/side') %>
```

### 1.2 文章单独存储

hexo 默认生成的文件夹路径不方便我们管理，经测试 `source/_posts` 文件夹下新建文件夹并不影响对 posts 文章数据的获取。

{% note message blue, 因此我们可以在 _posts 路径下，自定义文件夹来方便管理文章 %}

我们新建 `life` 文件夹用于存储“情侣日常”的文章，但是由于文章的内容还是采用了 `post.ejs` 的布局，所以会产生“前一篇”“后一篇”文章的获取可能出现错误，所以需要修改它。

还记得之前用于区别文章类型的 `custom_type` 变量吗？就是靠它大显神通啦！分别修改前后页的渲染即可，核心代码如下：

```ejs
<%
let prev_post = post.prev;
while (prev_post) {
  if (prev_post.custom_type == page.custom_type) { break }
  prev_post = prev_post.prev;
}
%>

<%
let next_post = post.next;
while (next_post) {
  if (next_post.custom_type == page.custom_type) { break }
  next_post = next_post.next;
}
%>
```

在 `_posts/life/` 下创建名为 `my-test.md` 的文章

```
hexo n life --path /life/my-test "my test title"
```

## 2. 情侣必做的 100 件事

采用单页面效果，定制起来方便一些

```
hexo n page todo-with-you
```

考虑到 TODO 可能还有个人版块，用 `type` 来区分渲染

```markdown
---
title: todo-with-you
date: 2021-02-19 09:43:46
updated: 2021-02-19 09:43:46
layout: todo
type: todo-with-you
---
```

主题配置 menu（略）

修改 `layout/todo.ejs`

```ejs
<%- partial(`_partial/${page.type}`) %>
```

修改 `layout/_partial/todo-with-you.ejs`

```ejs

```

## 3. 说说

